{
  "hash": "561582d4ddfe402a43e59eadb7ab3b1b",
  "result": {
    "markdown": "---\ntitle: \"Create: Interesting parcels and their access points\"\nauthor:\n  - name: Mike O'Brien\n    email: mikeob9@gmail.com\nresources: \n  - data\ncategories: [R, Henrico, Web scraping, Real estate, Land use]\n---\n\n\n\nOwners of Henrico parcels can be seen if clicking on \"Real Estate Data\" in the [GIS Viewer](https://portal.henrico.us/GISViewer/), but don't seem to be available via the [GeoData site](https://data-henrico.opendata.arcgis.com/). Luckily the [real estate search](https://realestate.henrico.us/) is API-friendly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(httr); library(rvest)\n\nhenrico_owner <- function(gpin){\n  url <- paste0(\n    'https://realestate.henrico.us/ords/cam/f?p=510101:5:::NO::P5_PARCEL_ID,P5_SEARCH_TYPE:',\n    gpin,\n    ',0'\n  )\n  \n  real_estate_info <- GET(url)\n  \n  data.frame(\n    gpin = gpin,\n    owner = real_estate_info|> \n    content() |> \n    html_element(\n      xpath = 'body/form/table[3]/tr/td[1]/table[1]/tr/td[2]/table/tr[2]/td/table/tr[7]/td[2]') |> \n    html_text()\n  )\n}\n```\n:::\n\n\nFilter Varina parcels by voting districts.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr);library(arrow); library(sf); library(geoarrow)\n\ndistricts <- read_sf('data/voting precincts/voting_precincts.shp',\n                     query = \"select * from Voting_Precincts where\n                     PRECINCT_N = 'Montrose' OR\n                     PRECINCT_N = 'Adams'\") |> \n  st_union()\n\n\nvarina <- open_dataset('data/henrico_parcels.parquet') |>\n  filter(MAGISTER_1 == 'Varina') |> \n  geoarrow_collect_sf()\n\nmontrose <- st_intersection(varina, st_transform(districts, st_crs(varina)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(future.apply)\nplan(multisession)\n\nparcel_owners <- future_lapply(montrose$GPIN, henrico_owner) |> \n  bind_rows()\n\nwrite.csv(parcel_owners, 'data/montrose_parcel_owners.csv')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nparcel_owners <- read.csv('data/montrose_parcel_owners.csv')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nparcels <- parcel_owners |> \n  filter(grepl('^RICHMOND (DEVELOPMENT|HOMES)|CHESAPEAKE BAY', owner) |\n           gpin %in% c('808-717-3392',\n                       '807-717-7478',\n                       '807-717-1292',\n                       '806-718-7211',\n                       '806-717-5171',\n                       '806-717-1889',\n                       '808-717-6457'))\nparcels <- montrose |> \n  right_join(parcels, by = c('GPIN' = 'gpin')) |> \n  mutate(owner = ifelse(is.na(owner), 'GILLIES CREEK INDUSTRIAL RECYCLING LLC',\n                        owner))\n\nwrite_sf(parcels, 'data/parcels.gpkg')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naccess_pts <- data.frame(\n  matrix(\n    c(-77.385338, 37.523702, \"richmond development, inc\",\n      -77.392297, 37.525004, 'ivester, david',\n      -77.384438, 37.529007, 'montrose, graham',\n      -77.383748, 37.525491, 'richmond development, inc',\n      -77.382565,  37.525508, 'richmond development, inc',\n      -77.383011, 37.522102, 'herrera martinez yumira',\n      -77.394685, 37.525799, 'workmens cemetery',\n      -77.380802, 37.527383, 'virginia tech'\n    ),\n    ncol = 3, byrow = T\n  )\n) |> \n  st_as_sf(coords = c('X1', 'X2'), crs = 4326)\n\nwrite_sf(access_pts, 'data/access_pts.gpkg')\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}